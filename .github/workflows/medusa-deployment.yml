name: Deploy to EC2  

on:  
  push:  
    branches:  
      - main  

jobs:  
  deploy:  
    runs-on: ubuntu-latest  
    steps:  
      - name: Checkout code  
        uses: actions/checkout@v2  

      - name: Setup SSH  
        uses: webfactory/ssh-agent@v0.5.4  
        with:  
          ssh-private-key: ${{ secrets.EC2_SSH_KEY }}  

      - name: Connect to EC2 and Deploy  
        run: |  
          ssh -o "StrictHostKeyChecking=no" ubuntu@${{ secrets.EC2_PUBIC_KEY }} << 'EOF'  
            cd /home/ubuntu/PearlThoughts-Medusa/Task-4/my-medusa-store || exit  
            git pull origin main  
            npm install  
            npx medusa migrations run  
            pm2 restart medusa || pm2 start npm --name "medusa" -- start  
          EOF
